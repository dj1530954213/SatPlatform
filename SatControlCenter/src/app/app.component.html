<div>
  <h1>SatControlCenter 控制面板</h1>

  <hr />

  <h2>1. WebSocket 连接</h2>
  <button (click)="connect()">连接到云端 ({{ wsUrl }})</button>
  <p><strong>连接状态:</strong> {{ (connectionStatus$ | async)?.connected ? '已连接 (Client ID: ' + ((connectionStatus$ | async)?.client_id ?? 'N/A') + ')' : ('未连接' + ((connectionStatus$ | async)?.error_message ? ' - 错误: ' + (connectionStatus$ | async)?.error_message : '')) }}</p>

  <hr />

  <h2>2. 客户端注册</h2>
  <div>
    <label for="groupId">组ID (GroupID): </label>
    <input id="groupId" type="text" [(ngModel)]="groupId" />
  </div>
  <div>
    <label for="taskId">任务ID (TaskID): </label>
    <input id="taskId" type="text" [(ngModel)]="taskId" />
  </div>
  <button (click)="register()" [disabled]="!(connectionStatus$ | async)?.connected || !groupId || !taskId">注册客户端到组和任务</button>
  <p><strong>注册状态:</strong> 
    <ng-container *ngIf="registrationStatus$ | async as status">
      {{ status.success ? '成功注册到组 ' + status.group_id + (status.assigned_client_id ? ' (分配 Client ID: ' + status.assigned_client_id + ')' : '') : ('注册失败: ' + (status.message ?? '未知错误')) }}
    </ng-container>
    <ng-container *ngIf="!(registrationStatus$ | async)">未注册</ng-container>
  </p>

  <hr />

  <h2>3. 伙伴客户端状态</h2>
  <p><strong>伙伴状态:</strong> 
    <ng-container *ngIf="partnerStatus$ | async as status">
      伙伴 {{ status.partner_role }} ({{ status.partner_client_id }}) {{ status.is_online ? '已上线' : '已下线' }} (组: {{ status.group_id }})
    </ng-container>
    <ng-container *ngIf="!(partnerStatus$ | async)">伙伴状态未知</ng-container>
  </p>

  <hr />

  <h2>4. 任务调试状态 (TaskDebugState)</h2>
  <p><strong>当前任务状态 (JSON):</strong></p>
  <pre>{{ taskState$ | async | json }}</pre>

  <hr />

  <h2>Echo 测试 (P2.2.1)</h2>
  <div>
    <label for="echoInput">要发送的内容: </label>
    <input id="echoInput" type="text" [(ngModel)]="echoInput" />
    <button (click)="sendEchoTest()" [disabled]="!(connectionStatus$ | async)?.connected || !echoInput">发送 Echo</button>
  </div>
  <p><strong>Echo 回复:</strong> {{ echoResponseMessage }}</p>

  <hr />
  <!-- P4.2.1 业务操作按钮区域 - 占位符 -->
  <h2>5. 业务操作 (占位符)</h2>
  <p><em>此处将添加用于触发具体业务操作（如预检查、单体测试步骤等）的按钮和表单。</em></p>
  <button disabled>(示例) 发送预检查项更新</button>
  <button disabled>(示例) 发起单体测试步骤</button>

</div>
